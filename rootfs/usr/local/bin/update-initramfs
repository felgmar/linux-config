#!/bin/sh

updateKernelImage()
{
    if test -z $1
    then
        PS3="Select a kernel preset: "
        select kernel_preset in $(find /etc/mkinitcpio.d/ -maxdepth 1 -type f -printf "%f\n" | cut -d "." -f 1)
        do
            selectedKernel="${kernel_preset}"
            if test "${selectedKernel}" != "${kernel_preset}" || test -z "${selectedKernel}"
            then
                echo "error: invalid kernel chosen, try again."
                exit 1
            fi

            mkinitcpio -p "${selectedKernel}"

            break
        done
    fi

    return $?
}

while getopts 'kh' arg
do
    case "${arg}" in
        k) updateKernelImage;;
        h) echo "usage: $0 [-k]"; exit 0;;
        ?)
            if test -z $1
            then
                echo "usage: $0 [-k]"; exit 0
                exit 1
            else
                echo "error: $1: unknown command"
                exit 1
            fi
        ;;
    esac
    break
done
