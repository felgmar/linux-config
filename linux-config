#!/bin/sh

help()
{
    echo "Usage: $0 [-a SCRIPT_ACTION] [-d LINUX_DISTRO]"
    return 1
}

if test -z $1
then
    help
    exit 1
fi

while getopts 'a:d:' arg
do
    case "${arg}" in
        a) export SCRIPT_ACTION="$OPTARG";;
        d) export LINUX_DISTRO="$OPTARG";;
        *) exit 1;;
    esac
done

case "$LINUX_DISTRO" in
    arch|archlinux)
        shift
        case "${SCRIPT_ACTION}" in
            setup-secure-boot)  LINUX_DISTRO=$LINUX_DISTRO sh tools/setup.sh;;
            install-tkg-kernel) LINUX_DISTRO=$LINUX_DISTRO sh kernels/setup.sh;;
            setup-rootfs)       LINUX_DISTRO=$LINUX_DISTRO sh rootfs/setup.sh;;
            setup-services)     LINUX_DISTRO=$LINUX_DISTRO sh tools/setup-services.sh;;
            install-packages)   LINUX_DISTRO=$LINUX_DISTRO sh packages/setup.sh;;
            *)
                if test ! -z "${SCRIPT_ACTION}"
                then
                    echo "error: $1: unknown action"
                    exit 1
                else
                    echo "error: $1: invalid action"
                    exit 1
                fi
        esac
    ;;
    *)
        if test ! -z $LINUX_DISTRO
        then
            echo "error: $LINUX_DISTRO: unknown distribution" && exit 1
        else
            echo "error: no distribution was specified" && exit 1
        fi
    ;;
esac

